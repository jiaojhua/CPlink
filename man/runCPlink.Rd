% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/CPlink.R
\name{runCPlink}
\alias{runCPlink}
\title{CPlink: identify phenotype-associated cells/spots from target single-cell / spatial data}
\usage{
runCPlink(
  Mtx,
  DEGs_mtx,
  snn,
  MCA_dim = 50,
  sim_methods = c("cosine", "pearson", "spearman", "euclidean")[1],
  up_weight = 0.5,
  down_weight = 0.5,
  seed_ratio = NULL,
  restart_prob = NULL,
  conv_threshold = 1e-05,
  nPermutations = 100,
  nCores = 1,
  SigThreshold = 0.05
)
}
\arguments{
\item{Mtx}{A count matrix (features x cells). Rows are feature identifiers
(genes/peaks) and columns are cell/spot identifiers. Must have rownames and colnames.}

\item{DEGs_mtx}{A data.frame containing phenotype-specific features and effect weights with:
\itemize{
  \item markers: Vector of phenotype-specific features
  \item logFC: Column name containing log fold changes (effect weights)
}}

\item{snn}{Sparse similarity matrix (e.g., SNN graph) for cell-cell (spot-spot) interactions.
 Typically the SNN graph produced by Seurat or a custom nearest-neighbor graph.
Row/column names must match the column names of `Mtx`. Accepts dense or dgCMatrix.}

\item{MCA_dim}{Integer scalar. Number of MCA components (dimensions) to retain when
computing feature-cell associations (default: 50).}

\item{sim_methods}{Similarity calculation method, one of:
c("cosine", "pearson", "spearman", "euclidean") (default: "cosine")}

\item{up_weight}{Weight for positive markers when computing initial cell
scores (default: 0.5).}

\item{down_weight}{Weight for negative markers when computing initial cell
scores (default: 0.5).}

\item{seed_ratio}{Numeric in (0,1) or NULL. Quantile threshold to select seed
nodes from the CellScore distribution (e.g., 0.95). If NULL, the function
chooses a value adaptively  (default: NULL).}

\item{restart_prob}{umeric in [0,1] or NULL. Restart probability for RWR. If NULL,
is chosen adaptively (default: NULL).}

\item{conv_threshold}{Numeric. Convergence threshold for RWR iterations (default: 1e-05)}

\item{nPermutations}{Integer. Number of permutations used to construct null distributions (default: 100)}

\item{nCores}{Integer. Number of CPU cores to use for permutation parallelization (default: 1).}

\item{SigThreshold}{Numeric in (0,1). Significance cutoff for empirical permutation p-values (default: 0.05).}
}
\value{
A list containing:
\itemize{
  \item pos_neg_score: Matrix with columns:
    \itemize{
      \item CellScore: Initial phenotype association score (before diffusion)
      \item pos_score: RWR diffusion score seeded from high CellScore cells
      \item neg_score: RWR diffusion score seeded from low CellScore cells
      \item CPlink_pos_score: Sigmoid-compressed positive diffusion score
      \item CPlink_neg_score: Sigmoid-compressed negative diffusion score
      \item CPlinkScore: Balanced CPlink phenotype score
    }
  \item res_permu: Permutation test results object
}
}
\description{
This function executes the core CPlink pipeline for transferring phenotype
knowledge (features and weights) learned from reference bulk data to target
single-cell or spatial data and then identifying phenotype-associated
cells/spots via diffusion (Random Walk with Restart) in permutation testing
framework.
}
